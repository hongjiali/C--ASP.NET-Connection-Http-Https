public class ConnectionHttp
    {
        private string m_host = "http://10.10.240.32/api/user/get";
        private string m_appkey = "b1c3e9c71bf266fb0bfc95d2cc6280c9";
        private string m_secretkey = "5f2b6905ce7b8a6cfc819be90ec61f2b";
      
        private ConnectionHttpResult GetResult(string url)
        {
            HttpWebRequest request = (HttpWebRequest)WebRequest.Create(url);
            request.Method = "GET";

            HttpWebResponse response = (HttpWebResponse)request.GetResponse();

            // Get the stream associated with the response.
            Stream receiveStream = response.GetResponseStream();

            // Pipes the stream to a higher level stream reader with the required encoding format. 
            StreamReader readStream = new StreamReader(receiveStream, Encoding.UTF8);
            string received = readStream.ReadToEnd();
            // Console.WriteLine("Response stream received.");
            //  Console.WriteLine (readStream.ReadToEnd ());
            //  Response.Write("<script>window.alert('" + readStream.ReadToEnd() + "');</script>");
            response.Close();
            readStream.Close();

            if (received == null && received == "") return null;

            ConnectionHttpResult result = null;
            using (var ms = new MemoryStream(Encoding.Unicode.GetBytes(received)))
            {
                DataContractJsonSerializer deseralizer = new DataContractJsonSerializer(typeof(SAES_M_comChatResult));
                result = (ConnectionHttpResult)deseralizer.ReadObject(ms);//反序列化ReadObject
            }

            return result;
        }

        public string GetUserID(string token)
        {
            try
            {
                string userId = "";
                if (token == null || token == "") return userId;
                string urlStr = m_host + "?access_token=" + token;
                //string urlStr = m_host + "?appkey=" + m_appkey + "&secretkey=" + m_secretkey + "&access_token=" + token;
                ConnectionHttpResult result = GetResult(urlStr);

                if(result.resultCode == 1)
                {
                    return result.data.employee_id;
                }
                return userId;
            }
            catch (Exception ex)
            {
                System.Diagnostics.Debug.Write(ex);
                return "";
            }
        }
    }

    //Entity
    public class ConnectionHttpUserInfoResult
    {
        public string dept { get; set; }//所在部门
        public string employee_id { get; set; }//工号
        public string locus { get; set; }//所在厂区
        public string nickname { get; set; }//名字
        public string telephone { get; set; }//电话号码
    }
    

    public class ConnectionHttpResult
    {
        public int resultCode { get; set; }
        public ConnectionHttpUserInfoResult data { get; set; }
    }
